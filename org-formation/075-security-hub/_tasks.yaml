Parameters:
  <<: !Include '../_parameters.yaml'

  appName:
    Type: String
    Default: 'securityhub'

  accountId:
    Type: String
    Description: The identifier from the account used to manage this service
    Default: !Ref SecurityCentralAccount

SecurityHub:
  Type: update-stacks
  Template: security-hub.yaml
  StackName: !Sub '${resourcePrefix}-${appName}'
  StackDescription: Setup SecurityHub service
  DefaultOrganizationBindingRegion: !Ref primaryRegion
  DefaultOrganizationBinding:
    Account: !Ref accountId

SecurityHubNotifications:
  Type: update-stacks
  Template: notifications.njk
  StackName: !Sub '${resourcePrefix}-${appName}-notifications'
  StackDescription: SecurityHub notifications
  DefaultOrganizationBindingRegion: !Ref primaryRegion
  DefaultOrganizationBinding:
    Account: !Ref accountId
  TemplatingContext:
    Subscriptions:
      # refer to https://docs.aws.amazon.com/sns/latest/api/API_Subscribe.html for valid list of protocol and endpoints
      - Protocol: "email"
        Endpoints: ["it-alert-inbox@sagebase.org"]

SecurityHubSuppressionInfra:
  DependsOn: [ SecurityHub ]
  Type: update-stacks
  Template: security-hub-suppress-infra.yaml
  StackName: !Sub '${resourcePrefix}-${appName}-suppression-infra'
  StackDescription: SecurityHub findings suppression queues and policies
  DefaultOrganizationBindingRegion: !Ref primaryRegion
  DefaultOrganizationBinding:
    Account: !Ref SecurityCentralAccount
  Parameters:
    AccessToQueueUserArnList:
    - 'arn:aws:sts::140124849929:assumed-role/AWSReservedSSO_Administrator_1de765cf1298ed53/x.schildwachter@sagebase.org'
