Parameters:
  <<: !Include '../_parameters.yaml'

  appName:
    Type: String
    Default: 'github-oidc'

GithubOidcSageBionetworks:
  Type: update-stacks
  Template: oidc-provider.yaml
  StackName: !Sub ${resourcePrefix}-${appName}
  Parameters:
    Url: "https://token.actions.githubusercontent.com"
    ThumbprintList:
      - "6938fd4d98bab03faadb97b34396831e3780aea1"
  DefaultOrganizationBinding:
    IncludeMasterAccount: true
    Account: '*'
    Region: us-east-1

GithubOidcSageBionetworksIt:
  Type: update-stacks
  DependsOn: GithubOidcSageBionetworks
  Template: github-oidc-provider-access.njk
  StackName: !Sub ${resourcePrefix}-${appName}-sage-bionetworks-it
  Parameters:
    GitHubOrg: "Sage-Bionetworks-IT"
    ProviderArn: !CopyValue [ !Sub '${resourcePrefix}-${appName}-ProviderArn' ]
    ManagedPolicyArns:
      - "arn:aws:iam::aws:policy/AdministratorAccess"
  TemplatingContext:
    Repositories:
      - name: "organizations-infra"
        branch: "master"
  DefaultOrganizationBinding:
    IncludeMasterAccount: true
    Account: '*'
    Region: us-east-1

GithubOidcSageBionetworksRecover:
  Type: update-stacks
  DependsOn: GithubOidcSageBionetworks
  Template: github-oidc-provider-access.njk
  StackName: !Sub ${resourcePrefix}-${appName}-sage-bionetworks-recover
  Parameters:
    GitHubOrg: "Sage-Bionetworks"
    ProviderArn: !CopyValue [ !Sub '${resourcePrefix}-${appName}-ProviderArn' ]
    ManagedPolicyArns:
      - "arn:aws:iam::aws:policy/AdministratorAccess"
  TemplatingContext:
    Repositories:
      - name: "recover"
        branch: "*"
  DefaultOrganizationBinding:
    Account:
      - !Ref RecoverProdAccount
      - !Ref RecoverDevAccount
    Region: us-east-1

GithubOidcSageBionetworksDataCuratorInfra:
  Type: update-stacks
  DependsOn: GithubOidcSageBionetworks
  Template: github-oidc-provider-access.njk
  StackName: !Sub ${resourcePrefix}-${appName}-sage-bionetworks-data-curator-infra
  Parameters:
    GitHubOrg: "Sage-Bionetworks"
    ProviderArn: !CopyValue [ !Sub '${resourcePrefix}-${appName}-ProviderArn' ]
    ManagedPolicyArns:
      - "arn:aws:iam::aws:policy/AdministratorAccess"
  TemplatingContext:
    Repositories:
      - name: "data_curator-infra"
        branch: "main"
  DefaultOrganizationBinding:
    Account:
      - !Ref DnTDevAccount
    Region: us-east-1
