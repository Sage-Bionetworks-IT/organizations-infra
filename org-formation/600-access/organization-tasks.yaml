
# A service account for https://github.com/nlpsandbox/aws-cloudformation
NlpSandboxServiceAccount:
  Type: update-stacks
  Template: https://raw.githubusercontent.com/Sage-Bionetworks/aws-infra/master/templates/IAM/service-account.yaml
  StackName: NlpSandboxServiceAccount
  MaxConcurrentStacks: 10
  Parameters:
    PolicyDocument: >-
        {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Sid": "ec2",
                    "Effect": "Allow",
                    "Action": [
                        "ec2:AuthorizeSecurityGroupEgress",
                        "ec2:AuthorizeSecurityGroupIngress",
                        "ec2:CreateTags",
                        "ec2:DescribeInstances",
                        "ec2:DescribeSecurityGroups",
                        "ec2:DeleteSecurityGroup",
                        "ec2:DeleteTags",
                        "ec2:RevokeSecurityGroupEgress",
                        "ec2:RunInstances",
                        "ec2:TerminateInstances"
                    ],
                    "Resource": "*",
                    "Condition": {
                        "StringEquals": {
                            "ec2:ResourceTag/Project": "nlpsandbox"
                        }
                    }
                },
                {
                    "Sid": "subnet",
                    "Effect": "Allow",
                    "Action": [
                        "ec2:CreateSecurityGroup",
                        "ec2:DescribeSubnets"
                    ],
                    "Resource": "*"
                },
                {
                    "Sid": "elb",
                    "Effect": "Allow",
                    "Action": [
                        "elasticloadbalancing:AddTags",
                        "elasticloadbalancing:DescribeTargetGroups",
                        "elasticloadbalancing:DescribeTargetHealth",
                        "elasticloadbalancing:DescribeLoadBalancers",
                        "elasticloadbalancing:DescribeListeners",
                        "elasticloadbalancing:DeleteTargetGroup",
                        "elasticloadbalancing:DeleteLoadBalancer",
                        "elasticloadbalancing:RemoveTags",
                        "elasticloadbalancing:CreateListener",
                        "elasticloadbalancing:CreateTargetGroup",
                        "elasticloadbalancing:CreateLoadBalancer",
                        "elasticloadbalancing:RegisterTargets"
                    ],
                    "Resource": "*"
                },
                {
                    "Sid": "s3",
                    "Effect": "Allow",
                    "Action": [
                        "s3:PutObject"
                    ],
                    "Resource": [
                        "arn:aws:s3:::bootstrap-awss3cloudformationbucket-*"
                    ]
                },
                {
                    "Sid": "cloudformation",
                    "Effect": "Allow",
                    "Action": [
                        "cloudformation:Create*",
                        "cloudformation:Describe*",
                        "cloudformation:UpdateStack",
                        "cloudformation:DeleteStack"
                    ],
                    "Resource": [
                        "arn:aws:cloudformation:us-east-1:563295687221:stackset/nlpsandbox:*",
                        "arn:aws:cloudformation:us-east-1:563295687221:stack/nlpsandbox/*"
                    ]
                }
            ]
        }
