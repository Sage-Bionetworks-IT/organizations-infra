Parameters:
  <<: !Include '../_parameters.yaml'

CloudTrail:
  Type: update-stacks
  Template: cloudtrail-trail.yaml
  StackName: !Sub '${resourcePrefix}-cloudtrail'
  StackDescription: CloudTrail
  DefaultOrganizationBindingRegion: !Ref primaryRegion
  DefaultOrganizationBinding:
    Account: !Ref LogCentralAccount
    IncludeMasterAccount: false
  Parameters:
    bucketName: !Sub '${resourcePrefix}-cloudtrail-${LogCentralAccount}'
    CloudWatchLogsLogGroupArn: !CopyValue [ !Sub '${primaryRegion}-${resourcePrefix}-cloudwatch-log-LogGroupArn' ]
    CloudWatchLogsRoleArn: !CopyValue [ !Sub '${primaryRegion}-${resourcePrefix}-cloudwatch-log-LogRoleArn' ]
    KmsKeyAdminPrincipalArns:
      - !Sub 'arn:aws:iam::${AWS::AccountId}:root'
      - !Sub 'arn:aws:iam::${AWS::AccountId}:role/OrganizationAccountAccessRole'
      - 'arn:aws:iam::531805629419:role/github-oidc-sage-bionetwo-ProviderRoleorganization-1EY1CRUF48VP5'
    # Must enable LogCentralAccount as the delegated Cloudtrail admin account
    # https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-add-delegated-administrator.html
    IsOrganizationTrail: true
